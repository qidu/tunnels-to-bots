# Tunnels-to-Bots Architecture

## Overview

A **public tunnel service platform** that enables OpenClaw instances to expose their bots via secure WebSocket tunnels, allowing mobile/web clients to connect and communicate with their bots remotely.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TUNNELS-TO-BOTS PLATFORM                              â”‚
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚   â”‚  OpenClaw A     â”‚         â”‚  OpenClaw B     â”‚                       â”‚
â”‚   â”‚  (User 1)       â”‚         â”‚  (User 2)       â”‚                       â”‚
â”‚   â”‚                 â”‚         â”‚                 â”‚                       â”‚
â”‚   â”‚  ğŸ¤– Bot: Clawra â”‚         â”‚  ğŸ¤– Bot: Helper â”‚                       â”‚
â”‚   â”‚  ğŸ¤– Bot: Coder  â”‚         â”‚  ğŸ¤– Bot: Writer â”‚                       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚            â”‚                           â”‚                                â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                       â”‚                                                 â”‚
â”‚                       â–¼                                                 â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚            â”‚   TUNNEL GATEWAY            â”‚                              â”‚
â”‚            â”‚   ws://tunnel.example.com   â”‚                              â”‚
â”‚            â”‚                             â”‚                              â”‚
â”‚            â”‚  â€¢ Authentication           â”‚                              â”‚
â”‚            â”‚  â€¢ Bot registration         â”‚                              â”‚
â”‚            â”‚  â€¢ Message routing          â”‚                              â”‚
â”‚            â”‚  â€¢ User isolation           â”‚                              â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                           â”‚                                             â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚            â”‚                              â”‚                              â”‚
â”‚            â–¼                              â–¼                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚   â”‚  Mobile App     â”‚           â”‚  Web Dashboard  â”‚                     â”‚
â”‚   â”‚  (User 1)       â”‚           â”‚  (User 1)       â”‚                     â”‚
â”‚   â”‚                 â”‚           â”‚                 â”‚                     â”‚
â”‚   â”‚  â€¢ Chat with    â”‚           â”‚  â€¢ Bot config   â”‚                     â”‚
â”‚   â”‚    Clawra bot   â”‚           â”‚  â€¢ Task manage  â”‚                     â”‚
â”‚   â”‚  â€¢ View tasks   â”‚           â”‚  â€¢ Stats        â”‚                     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## How It Works

### 1. Bot Registration Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OpenClaw   â”‚â”€â”€â”€â”€â–¶â”‚  Tunnel Gateway     â”‚â”€â”€â”€â”€â–¶â”‚  User's Bot     â”‚
â”‚  Instance   â”‚     â”‚  (WebSocket)        â”‚     â”‚  Registry       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚                 â”‚
         â–¼                 â–¼                 â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Bot:     â”‚     â”‚ Bot:     â”‚     â”‚ Bot:     â”‚
   â”‚ Clawra   â”‚     â”‚ Coder    â”‚     â”‚ Writer   â”‚
   â”‚ User:    â”‚     â”‚ User:    â”‚     â”‚ User:    â”‚
   â”‚ alice    â”‚     â”‚ alice    â”‚     â”‚ bob      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Note: alice's bots are ISOLATED from bob's bots
```

### 2. Connection Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mobile     â”‚   1. Connect (WebSocket)  â”‚  Tunnel Gateway     â”‚
â”‚  App        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â”‚ 2. Authenticate
                                              â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  Validate API Key   â”‚
                                    â”‚  (HMAC signature)   â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â”‚ 3. Return user ID
                                              â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  Fetch user's bots  â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  List: Clawra,      â”‚
                                    â”‚  Coder              â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Message Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mobile     â”‚â”€â”€â”€ Chat message â”€â”€â–¶â”                        â”‚  OpenClaw   â”‚
â”‚  App        â”‚                    â”‚                        â”‚  Instance   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚                               â”‚
                                    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
                                    â””â”€â”€â”€â–¶â”‚  Tunnel Gateway  â”‚â—€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚                  â”‚
                                         â”‚  1. Verify owner â”‚
                                         â”‚  2. Route to bot â”‚
                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â”‚
                                                  â–¼
                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                         â”‚  Clawra bot      â”‚
                                         â”‚  (OpenClaw)      â”‚
                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## OpenClaw Plugin Integration

### Plugin Location

```
tunnels-to-bots/
â”œâ”€â”€ openclaw-plugin/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.ts          # Plugin entry point
â”‚   â”‚   â”œâ”€â”€ channel.ts        # Tunnel channel plugin
â”‚   â”‚   â”œâ”€â”€ tunnel.ts         # Tunnel connection manager
â”‚   â”‚   â”œâ”€â”€ config.ts         # Configuration schema
â”‚   â”‚   â””â”€â”€ types.ts          # TypeScript definitions
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ README.md
â””â”€â”€ server/
    â””â”€â”€ src/
        â””â”€â”€ server-secure.js   # Secure tunnel server
```

### Plugin Responsibilities

1. **Bot Registration**
   - Register bots with tunnel gateway on startup
   - Heartbeat to keep connection alive
   - Handle reconnection on disconnect

2. **Message Routing**
   - Forward inbound messages to tunnel gateway
   - Route outbound messages to connected clients

3. **Configuration**
   - Tunnel server URL
   - API key for authentication
   - Bot list to expose

---

## Security Model

### User Isolation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         TUNNEL GATEWAY                   â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Alice's Session                  â”‚    â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚    â”‚
â”‚  â”‚ âœ… Can access: Clawra, Coder    â”‚    â”‚
â”‚  â”‚ âŒ Cannot access: Helper, Writerâ”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Bob's Session                    â”‚    â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚    â”‚
â”‚  â”‚ âŒ Cannot access: Clawra, Coder â”‚    â”‚
â”‚  â”‚ âœ… Can access: Helper, Writer   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API Key Security

```
API Key Format: t2b_<userId>_<hmac_signature>

Example: t2b_alice_a1b2c3d4e5f6g7h8

Generation:
1. Server stores: secret_key
2. Client request: userId = "alice"
3. Server computes: signature = HMAC-SHA256("alice:secret_key")
4. Returns: "t2b_alice_<first_16_chars>"
5. Client connects with: t2b_alice_a1b2c3d4e5f6g7h8
6. Server verifies using timing-safe comparison
```

---

## Deployment Options

### Option 1: Self-Hosted

```
User runs their own tunnel server:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User's Infrastructure                   â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ OpenClaw    â”‚â”€â”€â”€â”€â”€â–¶â”‚ Tunnel      â”‚   â”‚
â”‚  â”‚ Instance    â”‚      â”‚ Server      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                â”‚         â”‚
â”‚                         Mobile clients  â”‚
â”‚                         connect directlyâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Option 2: Public Platform

```
Multiple users share tunnel platform:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Public Platform Provider                â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Tunnel Gateway                  â”‚    â”‚
â”‚  â”‚                                 â”‚    â”‚
â”‚  â”‚  â€¢ Multi-tenant isolation       â”‚    â”‚
â”‚  â”‚  â€¢ Pay-per-use billing          â”‚    â”‚
â”‚  â”‚  â€¢ SLA guarantees               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚              â”‚                â”‚
â”‚    Alice's         Bob's               â”‚
â”‚    OpenClaw        OpenClaw            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Message Formats

### Register Bot

```json
{
  "type": "register_bot",
  "data": {
    "botId": "bot_clawra",
    "name": "Clawra",
    "type": "openclaw",
    "capabilities": ["chat", "tasks", "tools"]
  }
}
```

### Send Message (Client â†’ Bot)

```json
{
  "type": "message",
  "data": {
    "to": "bot_clawra",
    "text": "Hello! How are you?",
    "from": "client_alice",
    "timestamp": "2026-02-11T08:50:00Z"
  }
}
```

### Send Message (Bot â†’ Client)

```json
{
  "type": "message",
  "data": {
    "from": "bot_clawra",
    "to": "client_alice",
    "text": "I'm doing great, thanks for asking!",
    "timestamp": "2026-02-11T08:50:01Z"
  }
}
```

### Create Task

```json
{
  "type": "task",
  "data": {
    "botId": "bot_clawra",
    "title": "Review PR #123",
    "description": "Please review the new feature",
    "priority": "high"
  }
}
```

---

## Comparison: Tunnel vs Traditional Channels

| Aspect | Traditional Channel | Tunnel Service |
|--------|-------------------|----------------|
| Setup | Account per platform | One tunnel, many users |
| Scalability | Platform limits | Custom implementation |
| Control | Platform dependent | Full control |
| Privacy | Platform's rules | User isolation enforced |
| Cost | Per account | Per user/connection |
| Flexibility | Platform API limited | Full customization |

